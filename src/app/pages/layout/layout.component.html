<div class="layout-shell d-flex">
  <!-- Sidebar -->
  <div class="sidebar-container flex-column"
       [class.d-none]="!sidebarOpen()"
       [class.d-lg-flex]="true"
       [class.mobile-open]="sidebarOpen()">
    <div class="brand-row">
      <div class="brand-icon">
        <span class="fw-bold fs-5 text-white">T</span>
      </div>
      <div class="brand-text">
        <div class="brand-title">FinTracker</div>
        <div class="brand-sub">Personal finance</div>
      </div>
      <button class="sidebar-close d-lg-none" (click)="toggleSidebar()" aria-label="Close menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line x1="6" y1="6" x2="18" y2="18"></line>
          <line x1="6" y1="18" x2="18" y2="6"></line>
        </svg>
      </button>
    </div>

    <nav class="flex-grow-1">
      <div class="menu-label">Menu</div>

      <a routerLink="/dashboard" routerLinkActive="active" class="nav-link-custom">
        <span>Dashboard</span>
      </a>
      <a routerLink="/transactions" routerLinkActive="active" class="nav-link-custom">
        <span>Transactions</span>
      </a>
      <a routerLink="/categories" routerLinkActive="active" class="nav-link-custom">
        <span>Categories</span>
      </a>
      <a routerLink="/notifications" routerLinkActive="active" class="nav-link-custom">
        <span>Notifications</span>
      </a>
      <a routerLink="/reports" routerLinkActive="active" class="nav-link-custom">
        <span>Reports</span>
      </a>
      <a routerLink="/settings" routerLinkActive="active" class="nav-link-custom">
        <span>Settings</span>
      </a>
    </nav>

    <div class="mt-auto">
      <hr class="sidebar-divider" />
      <button class="signout-btn w-100 border-0 text-start" (click)="logout()">
        <span>Sign Out</span>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="flex-grow-1 bg-light main-panel">
    <!-- Top Header -->
    <header class="topbar">
      <div class="topbar-left">
        <button class="menu-toggle d-lg-none" (click)="toggleSidebar()" aria-label="Toggle menu">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <div>
          <div class="topbar-title">{{ pageTitle() }}</div>
          <div class="topbar-sub" *ngIf="pageSubtitle()">{{ pageSubtitle() }}</div>
        </div>
      </div>
      <div class="topbar-actions">
        <div class="data-menu" (click)="$event.stopPropagation()">
          <button class="data-btn" type="button" (click)="toggleDataMenu($event)">
            Data
            <span class="data-caret" aria-hidden="true">
              <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 6l4 4 4-4"></path>
              </svg>
            </span>
          </button>
          <span class="data-status" *ngIf="dataMessage()">{{ dataMessage() }}</span>
          <div class="data-dropdown" *ngIf="dataMenuOpen()">
            <div class="data-range">
              <label>Start</label>
              <input type="month" [ngModel]="reportStart()" (ngModelChange)="reportStart.set($event)">
              <label>End</label>
              <input type="month" [ngModel]="reportEnd()" (ngModelChange)="reportEnd.set($event)">
            </div>
            <button type="button" (click)="exportReportCsv()" [disabled]="reportBusy()">Export Report</button>
          </div>
        </div>

        <a routerLink="/notifications" class="text-decoration-none text-dark position-relative me-2"
          style="cursor: pointer;" (click)="onNotificationsClick($event)">
          <span class="icon-btn" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7" />
              <path d="M13.7 21a2 2 0 01-3.4 0" />
            </svg>
          </span>
          <span *ngIf="unreadCount() > 0"
            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
            style="font-size: 0.6rem;">
            {{ unreadCount() }}
          </span>
        </a>

        <button class="btn btn-link link-dark text-decoration-none p-0 me-2" (click)="themeService.toggle()"
          title="Toggle Theme">
          <span class="icon-btn" aria-hidden="true" *ngIf="themeService.theme() === 'light'">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12.8A9 9 0 1111.2 3a7 7 0 109.8 9.8z" />
            </svg>
          </span>
          <span class="icon-btn" aria-hidden="true" *ngIf="themeService.theme() === 'dark'">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="4" />
              <path d="M12 2v2M12 20v2M4.9 4.9l1.4 1.4M17.7 17.7l1.4 1.4M2 12h2M20 12h2M4.9 19.1l1.4-1.4M17.7 6.3l1.4-1.4" />
            </svg>
          </span>
        </button>

        <a routerLink="/settings" class="user-chip text-decoration-none" aria-label="Open settings">
          <span class="user-name">{{ displayName() }}</span>
          <span class="rounded-circle border d-flex align-items-center justify-content-center avatar-chip"
            style="width: 36px; height: 36px;">
            <span class="fw-bold text-muted small">{{ userInitials() }}</span>
          </span>
        </a>
      </div>
    </header>

    <main class="p-4 p-lg-5 pb-5 mb-5 mb-lg-0" (click)="closeSidebar()">
      <router-outlet></router-outlet>
    </main>
  </div>

  <!-- Mobile Bottom Nav -->
  <app-bottom-nav class="d-lg-none"></app-bottom-nav>
</div>
